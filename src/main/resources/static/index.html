<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Snapshot Web Demo</title>
    <style>
        .ui-warp {
            width: 100%;
            display: flex;
        }
        .ui-left #textarea {
            width: 600px;
            height: 600px;
        }
        .ui-right {
            margin-left: 15px;
        }
    </style>
</head>
<body>
    <h2><a href="https://github.com/muedsa/snapshot" target="_blank">Snapshot</a> Web Demo</h2>
    <a href="https://github.com/muedsa/snapshot-web" target="_blank">https://github.com/muedsa/snapshot-web</a>
    <div class="ui-warp">
        <div class="ui-left">
            <textarea id="textarea"><Snapshot background="#FFE59865" type="png">
  <Column>
    <Row>
      <Container width="266" height="266">
        <Stack>
          <Positioned left="5" top="5">
            <Image width="256" height="256" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/splash/xiangling.png" />
          </Positioned>
          <Positioned left="5" top="5">
            <Text color="#FFFFFFFF" fontSize="20" fontFamily="Noto Sans SC">哈哈</Text>
          </Positioned>
          <Positioned top="5" right="5">
            <Text color="#FFFFFFFF" fontSize="20" fontFamily="Noto Sans SC">等级 90</Text>
          </Positioned>
          <Positioned left="5" bottom="5">
            <Text color="#FFFFFFFF" fontSize="20" fontFamily="Noto Sans SC">9-9-10</Text>
          </Positioned>
          <Positioned right="5" bottom="5">
            <Text color="#FFFFFFFF" fontSize="20" fontFamily="Noto Sans SC">6</Text>
          </Positioned>
        </Stack>
      </Container>
      <Container width="266" height="266">
        <Stack>
          <Positioned left="5" top="5">
            <Container width="256" height="256">
              <Column>
                <Row mainAxisAlignment="SPACE_BETWEEN">
                  <Row>
                    <Image width="14" height="14" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/prop/hp.png" />
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">生命值</Text>
                  </Row>
                  <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">18337</Text>
                </Row>
                <Row mainAxisAlignment="SPACE_BETWEEN">
                  <Row>
                    <Image width="14" height="14" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/prop/attack.png" />
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">攻击力</Text>
                  </Row>
                  <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">1788</Text>
                </Row>
                <Row mainAxisAlignment="SPACE_BETWEEN">
                  <Row>
                    <Image width="14" height="14" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/prop/defense.png" />
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">防御力</Text>
                  </Row>
                  <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">891</Text>
                </Row>
                <Row mainAxisAlignment="SPACE_BETWEEN">
                  <Row>
                    <Image width="14" height="14" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/prop/critical_hit_rate.png" />
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">暴击率</Text>
                  </Row>
                  <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">61.37%</Text>
                </Row>
                <Row mainAxisAlignment="SPACE_BETWEEN">
                  <Row>
                    <Image width="14" height="14" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/prop/critical_hit_damage.png" />
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">暴击伤害</Text>
                  </Row>
                  <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">213.32%</Text>
                </Row>
                <Row mainAxisAlignment="SPACE_BETWEEN">
                  <Row>
                    <Image width="14" height="14" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/prop/energy_recharge.png" />
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">元素充能</Text>
                  </Row>
                  <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">169.22%</Text>
                </Row>
                <Row mainAxisAlignment="SPACE_BETWEEN">
                  <Row>
                    <Image width="14" height="14" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/prop/elemental_mastery.png" />
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">元素精通</Text>
                  </Row>
                  <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">112</Text>
                </Row>
                <Row mainAxisAlignment="SPACE_BETWEEN">
                  <Row>
                    <Image width="14" height="14" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/element/fire.png" />
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">火元素伤害加成</Text>
                  </Row>
                  <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">46.6%</Text>
                </Row>
              </Column>
            </Container>
          </Positioned>
          <Positioned right="5" bottom="5">
            <Column crossAxisAlignment="END">
              <Row crossAxisAlignment="START">
                <Column crossAxisAlignment="END">
                  <Row>
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">608</Text>
                    <Image width="14" height="14" url="hhttps://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/prop/attack.png" />
                  </Row>
                  <Row>
                    <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">66.2%</Text>
                    <Image width="14" height="14" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/prop/critical_hit_damage.png" />
                  </Row>
                </Column>
                <Border border="1 SOLID #FFFFFFFF" borderRadius="8">
                  <Image width="64" height="64" url="https://raw.githubusercontent.com/muedsa/taffy-pvp-card-sw/main/asset/image/weapon/polearm.png" />
                </Border>
              </Row>
              <Text color="#FFFFFFFF" fontSize="14" fontFamily="Noto Sans SC">护摩之杖</Text>
            </Column>
          </Positioned>
        </Stack>
      </Container>
    </Row>
  </Column>
</Snapshot></textarea>
            <div>
                <button id="submit">Submit</button>
            </div>
        </div>
        <div class="ui-right">
            <canvas class="" id="canvas">
                你的浏览器不支持 canvas，请升级你的浏览器。
            </canvas>
        </div>
    </div>
    <script>
        const btn = document.querySelector('#submit');
        const textarea = document.querySelector('#textarea');
        const canvas = document.querySelector('#canvas');
        canvas.width = 500;
        canvas.height = 500;
        const ctx = canvas.getContext('2d');
        function submitSnapshot() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.textBaseline = 'top';
            ctx.font = '15px serif';
            ctx.fillText('Loading', 0, 0);
            fetch('/snapshot', {
                method: 'post',
                body: textarea.value.trim()
            }).then(resp => resp.blob()).then(blob => {
                const reader = new FileReader();
                reader.onload = () => {
                    const image = new Image();
                    image.src = reader.result;
                    image.onload = () => {
                        canvas.width = image.naturalWidth;
                        canvas.height = image.naturalHeight;
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(image, 0, 0, image.naturalWidth, image.naturalHeight);
                    }
                }
                reader.readAsDataURL(blob);
            }).catch(e => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                console.log(e);
                ctx.fillText('error, please see more info from console', 0, 0);
            });
        }

        btn.addEventListener('click', submitSnapshot);
        document.addEventListener('DOMContentLoaded', submitSnapshot);
    </script>
</body>
</html>